<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WildOS map viewer</title>

    <style type="text/css">
    html {
        height: 100%;
    }

    body {
        margin-top: 40px;   /* make room for fixed menu bar */
        min-height: 100%;   /* together with html height, ensures body is at least as high as window so we can drag anywhere in it */
        background-color: #222;
        color: #ddd;
        font-family: Helvetica, sans-serif;
    }

    /* menu bar */
    #topbar {
        position: fixed;
        display: block;
        left: 0; top: 0; width: 100%;
        background-color: #444;
        border-bottom: 1px solid #ddd;
        padding-left: 5px;
        cursor: default;
    }
    #topbar .menu:hover {
        background-color: #ddd;
        color:  #444;
    }
    #topbar .menu {
        display: inline-block;
        padding: 5px;
        margin-right: 10px;
    }

    /* help panel */
    .close {
        text-align: right;
        padding-bottom: 5px;
    }
    #help {
        display: none;
        position: fixed;
        padding: 5px;
        background-color: #444;
        right: 20px;
    }

    /* error panel */
    #errorPanel {
        display: none;
        position: absolute;
        background-color: #444;
        padding: 20px;
        top: 100px;
        left: 200px;
        width: 600px;
        height: 300px;
    }
    #errorPanel h4 {
        margin-top: 0;
    }
    #closeError {
        position: absolute;
        right: 20px;
        bottom: 20px;
    }

    </style>

    <link rel="stylesheet" href="http://openlayers.org/en/v3.9.0/css/ol.css" type="text/css">
    <script src="http://openlayers.org/en/v3.9.0/build/ol.js" type="text/javascript"></script>

</head>
<body>
<div id="map">
</div>
<div id="topbar">
<div class="menu" onclick="alert('not implemented...')">Open Map</div><input style="display:none;" id="fileDialog" type="file" accept=".json"/>
<div class="menu" onclick="alert('not implemented...')">Change Layer</div>
<div class="menu" onclick="alert('not implemented...')">Gallery</div>
</div>

<div id="help">
<div class="close" onclick="$('#help').css('display', 'none')">&#x2716;</div>
<div>Show slide: click thumbnail</div>
<div>Next slide: <button onclick="app.nextSlide()">&rarr;</button> or <button onclick="app.nextSlide()">space</button></div>
<div>Previous slide: <button onclick="app.prevSlide()">&larr;</button></div>
<div>Gallery: <button onclick="$('.slide.current').click()">&#x21a9;</button> or click selected slide or "Gallery" menu</div>
<div>Load slideshow: use menu or drag file/folder to window</div>
</div>

<div id="errorPanel">
<h4>Errors while loading map:</h4>
<p><ul id="errors"></ul></p>
<button id="closeError">OK</button>
</div>

<script src="../../../content/jquery-2.1.1.min.js"></script>
<script type="text/javascript">
    // Get the slideshow app
    var app = global.platform.apps.getApp('Map');

    // Navigate with arrow keys + space bar + launch gallery with return
    // Note that we hijack the bindings from the gallery by setting our
    // handler first and by stopping propagation.
    $(document).on('keydown', function(event) {
            switch (event.which || event.keyCode) {
            case 13: // Return
                event.stopImmediatePropagation();
                return false;

            case 37: // Left
                event.stopImmediatePropagation();
                return false;

            case 39: // Right
            case 32: // Space
                event.stopImmediatePropagation();
                return false;

            }
    });

    // Display a panel with error messages
    function showErrors(errors) {
        if (! errors || errors.length === 0) {
            hideErrors();
            return;
        }

        var html = '';
        errors.forEach(function(error) {
            html += '<li>'+error+'</li>';
        });

        $('#errors').html(html);
        $('#errorPanel').show(200);
    }
    function hideErrors() {
        $('#errorPanel').hide(200);
    }
    $('#closeError').click(hideErrors);

    // Load the slide deck in the browser
    var mainView, mainMap;
    function loadMap() {
        var mainView = new ol.View({
            center: ol.proj.transform(app.center, 'EPSG:4326', 'EPSG:3857'),
            zoom: app.zoom
          });
        var mainMap = new ol.Map({
          target: 'map',
          layers: [
            new ol.layer.Tile({
              source: new ol.source[app.source](app.options), //MapQuest({layer: 'sat'})
            })
          ],
          view: mainView,
        });

        mainView.on('change:center', function(evt) { app.center = mainView.getCenter(); });
        mainView.on('change:resolution', function(evt) { app.zoom = mainView.getZoom(); });
    }

    loadMap();

</script>

</body>
</html>